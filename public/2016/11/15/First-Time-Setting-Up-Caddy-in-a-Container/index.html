<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>First Time Setting Up Caddy in a Container | Samuel Scheiderich</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Primary Goal: Setup Caddy as a static web server with a self-signed cert, in a LXD container.Secondary Goal: Setup proxy server to Node.js for dynamic content.Tertiary Goal: Setup FastCGI proxy for PH">
<meta name="keywords" content="developer experience,deployment,node,Caddy,Node.js,PHP">
<meta property="og:type" content="article">
<meta property="og:title" content="First Time Setting Up Caddy in a Container">
<meta property="og:url" content="http://samuelscheiderich.com/2016/11/15/First-Time-Setting-Up-Caddy-in-a-Container/index.html">
<meta property="og:site_name" content="Samuel Scheiderich">
<meta property="og:description" content="Primary Goal: Setup Caddy as a static web server with a self-signed cert, in a LXD container.Secondary Goal: Setup proxy server to Node.js for dynamic content.Tertiary Goal: Setup FastCGI proxy for PH">
<meta property="og:updated_time" content="2016-11-20T01:42:43.400Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="First Time Setting Up Caddy in a Container">
<meta name="twitter:description" content="Primary Goal: Setup Caddy as a static web server with a self-signed cert, in a LXD container.Secondary Goal: Setup proxy server to Node.js for dynamic content.Tertiary Goal: Setup FastCGI proxy for PH">
  
    <link rel="alternate" href="/atom.xml" title="Samuel Scheiderich" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Samuel Scheiderich</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/Samuel-Scheiderich">About me</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://samuelscheiderich.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-First-Time-Setting-Up-Caddy-in-a-Container" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/15/First-Time-Setting-Up-Caddy-in-a-Container/" class="article-date">
  <time datetime="2016-11-15T22:33:10.000Z" itemprop="datePublished">2016-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      First Time Setting Up Caddy in a Container
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Primary Goal: Setup Caddy as a static web server with a self-signed cert, in a LXD container.<br>Secondary Goal: Setup proxy server to Node.js for dynamic content.<br>Tertiary Goal: Setup FastCGI proxy for PHP.</p>
<h1 id="Article-OS-assumption"><a href="#Article-OS-assumption" class="headerlink" title="Article OS assumption"></a>Article OS assumption</h1><p>My base OS is Xubuntu 16.10. While technically LXD is not a Ubuntu-specific technology, I’m not as familiar with other distros, and won’t be providing instructions for other platforms.</p>
<h1 id="Do-basic-startup-of-container-image"><a href="#Do-basic-startup-of-container-image" class="headerlink" title="Do basic startup of container image"></a>Do basic startup of container image</h1><p>For starters, if you don’t have LXD/LXC (pronounced Lex-D and Lex-C), check out the <a href="https://linuxcontainers.org/lxd/getting-started-cli/" target="_blank" rel="external">installation instructions.</a> Don’t run <code>newgrp lxd</code> with sudo. I’m not sure why I thought that made sense, but no, that just adds the group to root, and drops you to the root terminal.</p>
<p>Create a new container with <code>lxc launch ubuntu:16.10 my-ubuntu</code>. I’m going to hazard a guess that everything will work on 16.04 as well, which is an LTS release.</p>
<p>If you aren’t familiar with LXD, we just created a running container based on a generic Ubuntu image. You can stop the container with <code>lxc stop my-ubuntu</code>. (The container is named ‘my-ubuntu’. You can name yours whatever you want.) To start your container back up, use <code>lxc start my-ubuntu</code>. To get a bash console in the container, run <code>lxc exec my-ubuntu bash</code>.</p>
<h1 id="Downloading-Caddy"><a href="#Downloading-Caddy" class="headerlink" title="Downloading Caddy"></a>Downloading Caddy</h1><p>The preferred method of downloading Caddy seems to be as a configurable <a href="https://caddyserver.com/download" target="_blank" rel="external">tar.gz download</a>. So I’ll do that and push it into the container manually. I chose the default HTTP core, ‘expires’ and ‘git’ directives/middleware, and no DNS providers (since this is a local-only instance). Make sure you know where you download the server to.</p>
<p>Push the file into the container with <code>lxc file push -p Downloads/caddy_linux_amd64_custom.tar.gz my-ubuntu/home/ubuntu/</code>. The <code>-p</code> flag tells <code>lxc file push</code> to create any folders which don’t already exist. If you get an error that the flag does exist, you are probably using lxd on 16.04 or older, which don’t have the flag. You can manually create any folder needed.</p>
<p>Enter bash into the container (<code>lxc exec my-ubuntu bash</code>), cd to where you pushed the file (<code>cd /home/ubuntu</code>), and run <code>tar -xzf caddy_linux_amd64_custom.tar.gz</code> to unpack.</p>
<p>Move caddy to <code>/usr/local/bin</code> with <code>mv caddy /usr/local/bin/</code>, and set ownership and permissions <code>chown root:root /usr/local/bin/caddy</code>, <code>chmod 755 /usr/local/bin/caddy</code>.</p>
<h1 id="Setup-daemon"><a href="#Setup-daemon" class="headerlink" title="Setup daemon"></a>Setup daemon</h1><p>We want Caddy to start up with the container. Fortunately, Caddy comes with some unofficial, unsupported scripts for setting this up. Recent Ubuntu uses systemd, so that’s the instruction set we’ll follow. The scripts are contained in the <code>init/</code> folder unpacked from the tar.gz, but you can also read the <a href="https://github.com/mholt/caddy/tree/master/dist/init/linux-systemd" target="_blank" rel="external">readme on github</a>.</p>
<p>We can skip the groupadd and useradd commands, as the Ubuntu container already has the appropriate ‘www-data’ user setup.</p>
<p>We need some folders setup:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># - From the readme</span></div><div class="line">sudo mkdir /etc/caddy</div><div class="line">sudo chown -R root:www-data /etc/caddy</div><div class="line">sudo mkdir /etc/ssl/caddy</div><div class="line">sudo chown -R www-data:root /etc/ssl/caddy</div><div class="line">sudo chmod 0770 /etc/ssl/caddy</div></pre></td></tr></table></figure></p>
<p>The next step requires that we have a Caddyfile setup.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://samuelscheiderich.com/2016/11/15/First-Time-Setting-Up-Caddy-in-a-Container/" data-id="cj1eb8vtp0002q8dmjup5i79i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Caddy/">Caddy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deployment/">deployment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/developer-experience/">developer experience</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/19/blog/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Getting a blog started
        
      </div>
    </a>
  
  
    <a href="/2017/04/08/getting-started-with-webpack/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Getting Started with Webpack</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Caddy/" style="font-size: 10px;">Caddy</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/Webpack/" style="font-size: 15px;">Webpack</a> <a href="/tags/deployment/" style="font-size: 15px;">deployment</a> <a href="/tags/developer-experience/" style="font-size: 20px;">developer experience</a> <a href="/tags/ghost/" style="font-size: 10px;">ghost</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/node/" style="font-size: 15px;">node</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/04/08/getting-started-with-webpack/">Getting Started with Webpack</a>
          </li>
        
          <li>
            <a href="/2016/11/15/First-Time-Setting-Up-Caddy-in-a-Container/">First Time Setting Up Caddy in a Container</a>
          </li>
        
          <li>
            <a href="/2016/09/19/blog/">Getting a blog started</a>
          </li>
        
          <li>
            <a href="/2016/07/04/Getting-started-with-React/">Getting started with React</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Samuel Scheiderich<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/Samuel-Scheiderich" class="mobile-nav-link">About me</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>